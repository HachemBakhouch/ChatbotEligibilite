"""
Module contenant les variantes des noms de villes pour aider à la détection
dans les réponses des utilisateurs du chatbot d'éligibilité.

Ce fichier est conçu pour être placé dans le dossier:
decision_tree_service/data/city_variants.py
"""

CITY_VARIANTS = {
    "saint-denis": [
        # Orthographes standard
        "saint-denis",
        "saint denis",
        "st-denis",
        "st denis",
        # Codes postaux
        "93200",
        "93 200",
        "93.200",
        "932 00",
        "93-200",
        "93200 saint denis",
        "93200 st denis",
        # Nombres écrits en toutes lettres
        "quatre-vingt-treize deux cents",
        "quatre vingt treize deux cents",
        # Variantes orthographiques et fautes courantes
        "sint deni",
        "sent denis",
        "sant denis",
        "sain denis",
        "saintdnis",
        "saiint denis",
        "saind denis",
        "saint-denys",
        "st.denis",
        "denis",
        "san denis",
        "san-denis",
        "sain denys",
        "s-denis",
        "saintenis",
        "saint_denis",
        "st_denis",
        "st.dénis",
        "s-d",
        "ville saint denis",
        "commune de saint denis",
        "st-dns",
        "sain-denis",
        "sen denis",
        "sndenis",
        "snt-denis",
        "snt denis",
        "sain dnis",
        "s.denis",
        "snt.denis",
        "sint-dnis",
        "sent-dns",
        "saintdénis",
        "st dénis",
        "saint dénis",
        "st. dénis",
        "saintdénys",
        # Nouvelles variantes
        "sdenis",
        "st-deni",
        "saintedenis",
        "st denis 93",
        "saint-denis 93",
        "saint-denis93",
        "st-denis93",
        "saint-denis seine saint denis",
        "st denis ssd",
        "saint-denis ssd",
        "sd",
        "std",
        "st-denis cedex",
        "saint denis cedex",
        "93200 cedex",
        "saint denis 93200",
        "st denis 93200",
        "ssaint denis",
        "saint dennis",
        "saint-dennis",
        "saint-deni",
        "saint deni",
        "saint denis ville",
        "stade de france",
        "la plaine",
        "la plaine saint denis",
        "la plaine st denis",
        "plaine saint denis",
        "plaine st denis",
        "ville de saint denis",
        "mairie de saint denis",
        "hotel de ville saint denis",
        "93 saint denis",
        "93 st denis",
    ],
    "stains": [
        # Orthographes standard
        "stains",
        # Codes postaux
        "93240",
        "93 240",
        "93.240",
        "932 40",
        "93-240",
        "93240 stains",
        # Nombres écrits en toutes lettres
        "quatre-vingt-treize deux cent quarante",
        "quatre vingt treize deux cent quarante",
        # Variantes orthographiques et fautes courantes
        "stins",
        "stain",
        "staine",
        "staïns",
        "staiin",
        "stains-sur-seine",
        "sains",
        "stane",
        "stenez",
        "staans",
        "stns",
        "st-ains",
        "st.ains",
        "stainz",
        "staines",
        "s-taine",
        "stainns",
        "stains93",
        "ville stains",
        "stns 93",
        "staens",
        "stans",
        "stainez",
        "s.tains",
        "staints",
        "stainzz",
        "staen",
        "stainez",
        "staings",
        "st.in",
        "st_ains",
        "stn.s",
        "staints93",
        "sta-in",
        "s-tains",
        "commune stains",
        "quartier stains",
        "ville de stains",
        "st1ns",
        "stzns",
        # Nouvelles variantes
        "stainnes",
        "stain sur seine",
        "estains",
        "esstains",
        "93 stains",
        "stains 93240",
        "stains ville",
        "commune de stains",
        "stay",
        "stain 93",
        "stains seine saint denis",
        "stains ssd",
        "stain ssd",
        "stain-sur-seine",
        "city of stains",
        "steins",
        "staains",
        "sténs",
        "93240 cedex",
        "stins 93",
        "stains cedex",
        "mairie de stains",
        "hotel de ville stains",
    ],
    "pierrefitte": [
        # Orthographes standard
        "pierrefitte",
        "pierrefitte sur seine",
        "pierrefitte-sur-seine",
        # Variantes orthographiques et fautes courantes
        "pierrefite",
        "pierfitte",
        "pierre fitte",
        "pierre-fit",
        "pierefitte",
        "pierfet",
        "pierrette",
        "pierreffite",
        "pierre fite",
        "perrefitte",
        "pirefite",
        "pirrefitte",
        "pierrefit",
        "peirrefitte",
        "peirefit",
        "pierre fitte sur seine",
        "pierre fit sur seine",
        "pierrefitte seine",
        "pierrefitte-seine",
        "pierrefitte-sur-saine",
        "pierrefitte su sein",
        "pierre fite seine",
        "pierfit",
        "pierfit-sur-seine",
        "pierrefit-sur-seine",
        "prrfitt",
        "pierfftte",
        "pierrephitte",
        "pierffite",
        "pierrfite",
        "pierfait",
        "pierfitt",
        "pierfit sur seine",
        "pierre-fitte-sur-seine",
        "pierrafitte",
        "pyerrefitte",
        "piere fitte",
        # Codes postaux
        "93380",
        "93 380",
        "93.380",
        "933 80",
        "93-380",
        "93380 pierrefitte",
        # Nombres écrits en toutes lettres
        "quatre-vingt-treize trois cent quatre-vingts",
        "quatre vingt treize trois cent quatre vingts",
        # Nouvelles variantes
        "pierrefitte93",
        "pierrefitte 93",
        "pierrefitte-93",
        "p-fitte",
        "pfitte",
        "p fitte",
        "pierre-fitte",
        "93 pierrefitte",
        "pierrefitte seine saint denis",
        "pierrefitte ssd",
        "pierrefitte s seine",
        "pierrefitte s/seine",
        "pierrefitte/seine",
        "pierrefitte sur s",
        "p sur seine",
        "pierre sur seine",
        "pierrefitte 93380",
        "93380 pierrefitte sur seine",
        "pierre-fitte s/ seine",
        "pfit",
        "pfitte sur seine",
        "Pierre Fitt",
        "Pierre Fitz",
        "Pire fit",
        "pierre fitte commune",
        "commune de pierrefitte",
        "ville de pierrefitte",
        "mairie de pierrefitte",
        "pierre-fittes",
        "pierrefittte",
        "pierre-sur-seine",
        "pierrefitte cedex",
        "PIR-FIT",
        "hotel de ville pierrefitte",
    ],
    "saint-ouen": [
        # Orthographes standard
        "saint-ouen",
        "saint ouen",
        "st-ouen",
        "st ouen",
        "saint-ouen-sur-seine",
        # Codes postaux
        "93400",
        "93 400",
        "93.400",
        "934 00",
        "93-400",
        "93400 saint ouen",
        # Nombres écrits en toutes lettres
        "quatre-vingt-treize quatre cents",
        "quatre vingt treize quatre cents",
        # Variantes orthographiques et fautes courantes
        "sint ouen",
        "sant ouen",
        "sent ouen",
        "sain ouen",
        "saintowen",
        "saint ouane",
        "saintouen",
        "st-ouan",
        "st-ouane",
        "stouen",
        "snt-ouen",
        "snt ouen",
        "st_ouen",
        "saint_oen",
        "saint-oen",
        "ouen",
        "oüen",
        "saint0uen",
        "saint-ouén",
        "saint-owen",
        "saint-ouan",
        "saint-ouèn",
        "s-ouen",
        "st-ouèn",
        "s.ouen",
        "saint-ouin",
        "saintowène",
        "saint.ouen",
        "sntouen",
        "stouèn",
        "ouène",
        "ouan",
        "commune saint ouen",
        "ville de saint ouen",
        "quartier saint ouen",
        # Nouvelles variantes
        "saint-ouen93",
        "saint ouen 93",
        "st-ouen93",
        "st ouen 93",
        "93 saint ouen",
        "93 st ouen",
        "saintouen sur seine",
        "st-ouen sur seine",
        "saint ouen sur seine",
        "saintouen/seine",
        "st-ouen/seine",
        "stoven",
        "saint owen",
        "st owen",
        "souen",
        "st owen sur seine",
        "saint owen sur seine",
        "saint-ouen ville",
        "st-ouen ville",
        "ouene",
        "saint ouen 93400",
        "st ouen 93400",
        "93400 saint ouen sur seine",
        "93400 st ouen sur seine",
        "sowen",
        "stoen",
        "saint ouen seine saint denis",
        "st ouen seine saint denis",
        "saint ouen ssd",
        "st ouen ssd",
        "mairie de saint ouen",
        "mairie de st ouen",
        "hotel de ville saint ouen",
        "hotel de ville st ouen",
        "saint ouen cedex",
        "st ouen cedex",
    ],
    "épinay-sur-seine": [
        # Orthographes standard
        "epinay",
        "épinay",
        "epinay-sur-seine",
        "épinay-sur-seine",
        # Codes postaux
        "93800",
        "93 800",
        "93.800",
        "938 00",
        "93-800",
        "93800 epinay",
        # Nombres écrits en toutes lettres
        "quatre-vingt-treize huit cents",
        "quatre vingt treize huit cents",
        # Variantes orthographiques et fautes courantes
        "epinaï",
        "epiny",
        "epinai",
        "epiné",
        "epinaye",
        "epinae",
        "epinaye-sur-seine",
        "epinay sur seine",
        "epinay/Seine",
        "epinaÿ",
        "epinnay",
        "epinny",
        "epny",
        "epinaiy",
        "epinau",
        "epinnaï",
        "epinhe",
        "epenaï",
        "epnay",
        "e.pinay",
        "epin_ai",
        "epin.ai",
        "epin",
        "épiné",
        "epinai-sur-seine",
        "epinnaye",
        "épinaÿ-sur-seine",
        "epinay-sur-senne",
        "epinay-sur-scène",
        "epynay",
        "epinné",
        "epigny",
        "epinets",
        "commune epinay",
        "ville epinay",
        "quartier epinay",
        # Nouvelles variantes
        "epinay93",
        "épinay93",
        "epinay 93",
        "épinay 93",
        "93 epinay",
        "93 épinay",
        "epinay/seine",
        "épinay/seine",
        "epinay s/seine",
        "épinay s/seine",
        "epinay s seine",
        "épinay s seine",
        "epinay seine",
        "épinay seine",
        "epinay-s-seine",
        "épinay-s-seine",
        "93800 epinay sur seine",
        "93800 épinay sur seine",
        "epinay 93800",
        "épinay 93800",
        "epinay-seine",
        "épinay-seine",
        "epinay sur s",
        "épinay sur s",
        "epinay-s",
        "épinay-s",
        "epinay seine saint denis",
        "épinay seine saint denis",
        "epinay ssd",
        "épinay ssd",
        "epine",
        "épine",
        "epinaysurseine",
        "épinaysurseine",
        "commune de epinay",
        "commune d'epinay",
        "commune de épinay",
        "commune d'épinay",
        "ville de epinay",
        "ville d'epinay",
        "ville de épinay",
        "ville d'épinay",
        "mairie de epinay",
        "mairie d'epinay",
        "mairie de épinay",
        "mairie d'épinay",
        "epinay cedex",
        "épinay cedex",
        "hotel de ville epinay",
        "hotel de ville épinay",
    ],
    "villetaneuse": [
        # Orthographes standard
        "villetaneuse",
        "ville tanneuse",
        "ville-tanneuse",
        "ville taneuse",
        # Codes postaux
        "93430",
        "93 430",
        "93.430",
        "934 30",
        "93-430",
        "93430 villetaneuse",
        # Nombres écrits en toutes lettres
        "quatre-vingt-treize quatre cent trente",
        "quatre vingt treize quatre cent trente",
        # Variantes orthographiques et fautes courantes
        "viltaneuse",
        "villetaneus",
        "villetanuse",
        "villetneuse",
        "villetanus",
        "villetaneze",
        "villetaneuz",
        "villetaneuse93",
        "villetaneusse",
        "villetanusz",
        "viltneuse",
        "viltenause",
        "villetaineuse",
        "villetaneusé",
        "villetannes",
        "villetaneause",
        "villetaneusze",
        "viltanuse",
        "villetanése",
        "villetnaeuse",
        "vltaneuse",
        "vilta-neuse",
        "v.neuse",
        "villetanues",
        "ville-neuse",
        "vltneuse",
        "vltneuze",
        "vltaneuse93",
        "villetneuze",
        "vilta_neuse",
        "commune villetaneuse",
        "quartier villetaneuse",
        "ville de villetaneuse",
        "villetann",
        "vltaneus",
        # Nouvelles variantes
        "vtaneuse",
        "v taneuse",
        "ville-t",
        "v-taneuse",
        "villetanse",
        "villetaneuse 93",
        "villetaneuse-93",
        "93 villetaneuse",
        "villetaneuse 93430",
        "93430 villetaneuse",
        "villetaneuze",
        "ville-taneuse",
        "ville.taneuse",
        "villet",
        "villetaneuze",
        "villetanuese",
        "villetaneuse ssd",
        "villetaneuse seine saint denis",
        "vile taneuse",
        "villetaneuse commune",
        "commune de villetaneuse",
        "vill-taneuse",
        "villataneuse",
        "villa taneuse",
        "villetaneuse cedex",
        "vt",
        "mairie de villetaneuse",
        "hotel de ville villetaneuse",
    ],
    "île-saint-denis": [
        # Orthographes standard
        "ile-saint-denis",
        "île-saint-denis",
        "ile saint denis",
        "île saint denis",
        # Codes postaux
        "93450",
        "93 450",
        "93.450",
        "934 50",
        "93-450",
        "93450 ile saint denis",
        # Nombres écrits en toutes lettres
        "quatre-vingt-treize quatre cent cinquante",
        "quatre vingt treize quatre cent cinquante",
        # Variantes orthographiques et fautes courantes
        "ile st denis",
        "isle saint denis",
        "île st denis",
        "isle-st-denis",
        "ile de saint denis",
        "isle de saint denis",
        "ile_saint_denis",
        "île_saint_denis",
        "ilestdenis",
        "ilestdénis",
        "île-st-denis",
        "ile-st-denis",
        "île_saintdenis",
        "island saint denis",
        "ile de st denis",
        "île de st denis",
        "i.s.denis",
        "isd",
        "i s d",
        "île denis",
        "isle denis",
        "île saint-dénis",
        "île-st.denis",
        "ile st.denis",
        "île sd",
        "île93",
        "île-seine93",
        "denis île",
        "stdenis-île",
        "commune île-saint-denis",
        "ville île st denis",
        "quartier île st denis",
        # Nouvelles variantes
        "lile saint denis",
        "l'ile saint denis",
        "l'île saint denis",
        "l'isle saint denis",
        "lile-saint-denis",
        "l'ile-saint-denis",
        "l'île-saint-denis",
        "ilesaintdenis",
        "îlesaintdenis",
        "93 ile saint denis",
        "93 île saint denis",
        "ile saint denis 93",
        "île saint denis 93",
        "ile-st-d",
        "île-st-d",
        "isd93",
        "île-saint-denis93",
        "ile-saint-denis93",
        "i-s-d",
        "i.st.d",
        "isle st denis",
        "ile saint denis 93450",
        "île saint denis 93450",
        "93450 ile saint denis",
        "93450 île saint denis",
        "île saint denis ssd",
        "ile saint denis ssd",
        "île saint denis seine saint denis",
        "ile saint denis seine saint denis",
        "isd ssd",
        "ile st denis 93",
        "île st denis 93",
        "l'ile st denis",
        "l'île st denis",
        "commune de l'ile saint denis",
        "commune de l'île saint denis",
        "ville de l'ile saint denis",
        "ville de l'île saint denis",
        "mairie de l'ile saint denis",
        "mairie de l'île saint denis",
        "ile st denis cedex",
        "île st denis cedex",
        "hotel de ville ile saint denis",
        "hotel de ville île saint denis",
    ],
    "aubervilliers": [
        # Orthographes standard
        "aubervilliers",
        # Codes postaux
        "93300",
        "93 300",
        "93.300",
        "933 00",
        "93-300",
        "93300 aubervilliers",
        # Nombres écrits en toutes lettres
        "quatre-vingt-treize trois cents",
        "quatre vingt treize trois cents",
        # Variantes orthographiques et fautes courantes
        "auberville",
        "aubervilier",
        "auberviliers",
        "aubervillier",
        "aubervilleirs",
        "auber",
        "aubrvilliers",
        "auberv",
        "aubervilliere",
        "aubervillé",
        "aubrville",
        "aubrviller",
        "aubervilles",
        "aubr",
        "aubervilles93",
        "aubrvile",
        "aubervillières",
        "aubvervilliers",
        "aubervillies",
        "aubrvilles",
        "aubervlliers",
        "auber-villiers",
        "auber_villiers",
        "aub-villiers",
        "aubervil",
        "aubrvilez",
        "aubervillieur",
        "aubervillez",
        "aubr-ville",
        "aubervillièrs",
        "auberviilers",
        "aubrvllrs",
        "aubrvillrs",
        "aubrvillr",
        "aubervilliére",
        "aubrvlrs",
        "aubervillee",
        "commune aubervilliers",
        "ville aubervilliers",
        "quartier aubervilliers",
        # Nouvelles variantes
        "aubervilier",
        "aubervillers",
        "aubervillié",
        "auberviliez",
        "aubervilliés",
        "aubervilié",
        "auberv.",
        "a.villiers",
        "avilliers",
        "avillier",
        "aubervil",
        "aubervilliers 93",
        "aubervilliers-93",
        "aubervilliers93",
        "93 aubervilliers",
        "aubervilliers 93300",
        "93300 aubervilliers",
        "aub",
        "aubville",
        "ville d'aubervilliers",
        "commune d'aubervilliers",
        "aubervilliers ssd",
        "aubervilliers seine saint denis",
        "auber 93",
        "auber 93300",
        "aubervilliers cedex",
        "commune de aubervilliers",
        "mairie de aubervilliers",
        "mairie d'aubervilliers",
        "auber ville",
        "auber-ville",
        "obrville",
        "hotel de ville aubervilliers",
    ],
    "la-courneuve": [
        # Orthographes standard
        "la courneuve",
        "la-courneuve",
        # Codes postaux
        "93120",
        "93 120",
        "93.120",
        "931 20",
        "93-120",
        "93120 la courneuve",
        # Nombres écrits en toutes lettres
        "quatre-vingt-treize cent vingt",
        "quatre vingt treize cent vingt",
        # Variantes orthographiques et fautes courantes
        "courneuve",
        "lacourneuve",
        "la-courneu",
        "la courneu",
        "la-courneuv",
        "lacourneu",
        "lacourneuv",
        "la corneuve",
        "la cournev",
        "la corneu",
        "l-courneuve",
        "courneu",
        "courneuv",
        "courneuve93",
        "la courneuve 93",
        "la cournve",
        "la.courneuve",
        "l.courneuve",
        "la_courneuve",
        "la courneuvez",
        "la corneuv",
        "lacorneuve",
        "courneuve ville",
        "commune la courneuve",
        "quartier la courneuve",
        "lacour_neuve",
        "la-cour.nueve",
        "la courneuvez",
        "lacournev",
        "la curneve",
        "la courneuive",
        "la courneuvve",
        "la couneuve",
        "la cou-neuve",
        "la cour-neuve",
        # Nouvelles variantes
        "lacourneuve93",
        "la-courneuve93",
        "la courneuve93",
        "la courneuve-93",
        "la courneuve 93120",
        "la-courneuve 93120",
        "93 la courneuve",
        "93120 la-courneuve",
        "lcourneuve",
        "l-c-n",
        "l.c.n",
        "lcn",
        "la courneuve seine saint denis",
        "la courneuve ssd",
        "la-courneuve ssd",
        "la c",
        "la courneuve commune",
        "la-courneuve commune",
        "commune de la courneuve",
        "ville de la courneuve",
        "la kurneuve",
        "la kourneuve",
        "la cournoeuv",
        "la courneuve cedex",
        "la-courneuve cedex",
        "mairie de la courneuve",
        "hotel de ville la courneuve",
    ],
}


# Fonction utilitaire pour rechercher une ville à partir d'une chaîne de texte
def find_city_from_text(text):
    """
    Recherche une ville correspondante à partir d'un texte.

    Args:
        text (str): Texte à analyser pour trouver une ville

    Returns:
        str or None: Nom normalisé de la ville trouvée ou None si aucune correspondance
    """
    if not text:
        return None

    text_lower = text.lower().strip()

    # Vérifier les codes postaux
    postal_code_mapping = {
        "93200": "saint-denis",
        "93240": "stains",
        "93380": "pierrefitte",
        "93400": "saint-ouen",
        "93800": "épinay-sur-seine",
        "93430": "villetaneuse",
        "93450": "île-saint-denis",
        "93300": "aubervilliers",
        "93120": "la-courneuve",
    }

    # Recherche de code postal dans le texte
    import re

    postal_code_match = re.search(r"93\s*[0-9]{3}", text_lower)
    if postal_code_match:
        postal_code = postal_code_match.group().replace(" ", "")
        if postal_code in postal_code_mapping:
            return postal_code_mapping[postal_code]

    # Recherche par variantes
    for city_key, variants in CITY_VARIANTS.items():
        for variant in variants:
            if variant in text_lower or variant.replace("-", " ") in text_lower:
                return city_key

    return None


# Fonction pour normaliser le nom d'une ville
def normalize_city_name(city_name):
    """
    Normalise le nom d'une ville en le convertissant en clé standard.

    Args:
        city_name (str): Nom de ville à normaliser

    Returns:
        str or None: Clé normalisée de la ville ou None si non reconnue
    """
    if not city_name:
        return None

    city_lower = city_name.lower().strip()

    # Vérifier si c'est déjà une clé
    if city_lower in CITY_VARIANTS:
        return city_lower

    # Chercher dans les variantes
    for city_key, variants in CITY_VARIANTS.items():
        if city_lower in variants or city_lower.replace("-", " ") in variants:
            return city_key

    # Essayer de trouver dans le texte complet
    return find_city_from_text(city_lower)
